pipeline {
agent {
node {
label 'docker'
}
}

stages {

stage('code compile') {

agent {
docker {
alwaysPull true
reuseNode true
image 'maven:3-amazoncorretto-11'
}
}
steps {
script {
configFileProvider([configFile(fileId: 'ss-m2-settings', variable: 'M2_SETTINGS')]) {

sh 'mvn -s $M2_SETTINGS -B -e compile'
}
}
}

}


stage('Build and package') {
agent {
docker {
alwaysPull true
reuseNode true
image 'maven:3-amazoncorretto-11'

}
}
steps {
//sh 'mvn clean install -DskipTests'
sh 'mvn clean package -DskipTests'
sh 'ls -lart'
sh 'pwd'

}


}
}
}

